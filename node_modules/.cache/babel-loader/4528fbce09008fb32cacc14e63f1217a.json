{"ast":null,"code":"(function () {\n  var MODAL_CONTAINER_ID = \"ep-modal-container\";\n  var MODAL_BODY_ID = \"ep-modal-body\";\n  var BTN_CLOSE_ID = \"ep-modal-close\";\n  var BASE_PATH = \"/payment\";\n  var MESSAGE_FAIL_LOADING = \"epframe.fail_loading\";\n  var MESSAGE_RESIZE = \"epframe.resize\";\n  var MESSAGE_LOADED = \"epframe.loaded\";\n  var MESSAGE_EXIT = \"epframe.exit\";\n  var MESSAGE_REDIRECT = \"epframe.redirect\";\n  var MESSAGE_REDIRECT_IFRAME = \"epframe.redirect_iframe\";\n  var MESSAGE_REDIRECT_IFRAME_COMPLETE = \"epframe.redirect_iframe_complete\";\n  var MESSAGE_TEMPLATE_NAME = \"epframe.template_name\";\n  var MESSAGE_WITH_QR_PAY = \"epframe.with_qr_pay\";\n  var MESSAGE_CHANGE_CROSS_COLOR = \"epframe.cross_color\";\n  var MESSAGE_RESIZE_FROM_ANOTHER_SRC = \"epframe.resize_from_another_src\";\n  var MESSAGE_REMOVE_CSS_CLASS = \"epframe.remove_css_class\";\n  var MODE_PURCHASE = \"purchase\";\n  var FRAME_MODE_IFRAME = \"iframe\";\n  var FRAME_MODE_POPUP = \"popup\";\n  var FRAME_MODE_TAB = \"tab\";\n  /**\r\n   * Class for widget instance\r\n   * @param {string} guid\r\n   * @param {HTMLElement} btn\r\n   * @param {Object} config\r\n   * @param {string} method\r\n   * @constructor\r\n   */\n\n  var PayWidget = function (guid, btn, config, method) {\n    var widgetInstance = this;\n    this.btn = btn;\n    this.iframe = null;\n    this.guid = guid;\n    this.method = method || \"get\";\n    this.widgetLoaded = false;\n    this.frameMode = FRAME_MODE_TAB;\n    this.callback_last_state = {\n      onResize: {\n        width: 0,\n        height: 0\n      },\n      onAmountChange: {\n        value: undefined\n      },\n      onTabChange: {\n        tab: undefined\n      }\n    };\n\n    this.getBaseUrl = function () {\n      if (config.baseUrl) {\n        return config.baseUrl;\n      } else {\n        return WidgetLibrary.getBaseUrl();\n      }\n    };\n    /**\r\n     * Validate config and fix it if possible\r\n     * @param config\r\n     */\n\n\n    this.validateConfig = function (config) {\n      var allowedModes = [\"purchase\", \"payout\", \"card_tokenize\", \"card_verify\", \"money_transfer\"];\n\n      if (config.mode && allowedModes.indexOf(config.mode) < 0) {\n        throw \"Invalid config.mode. Use: \" + allowedModes.concat(\" | \");\n      }\n\n      if (config.mode === MODE_PURCHASE && (!config.payment_id || !config.payment_currency)) {\n        throw \"Payment not specified.\";\n      }\n    };\n    /**\r\n     * Default onExit callback\r\n     */\n\n\n    this.onExit = function () {\n      var modal_el = document.getElementById(MODAL_CONTAINER_ID);\n      var modal_body_el = document.getElementById(MODAL_BODY_ID);\n      document.getElementById(\"ep-modal-wrap\").classList.remove(\"loaded\");\n      modal_body_el.removeAttribute(\"style\");\n      modal_el.classList.remove(\"shown\");\n    };\n\n    this.showIframeRedirect = function () {\n      document.getElementById(\"ep-modal-wrap\").classList.add(\"with-asc\");\n    };\n\n    this.redirectComplete = function () {\n      document.getElementById(\"ep-modal-wrap\").classList.remove(\"with-asc\");\n    };\n    /**\r\n     * Show widget in site DOM element\r\n     */\n\n\n    this.showInSiteElement = function () {\n      var target_element = config.target_element;\n      var el = null;\n      this.setFrameMode(FRAME_MODE_IFRAME);\n\n      if (typeof target_element == \"string\") {\n        el = document.getElementById(target_element);\n      } else {\n        el = config.target_element;\n      }\n\n      if (!el) {\n        throw \"Invalid target_element\";\n      }\n\n      if (el.childNodes[0]) {\n        this.unloadIframe(el.childNodes[0]);\n      }\n\n      var iframe = this.createIframe();\n      iframe.addEventListener(\"load\", function () {\n        for (var i = 0; i < el.childNodes.length; i++) {\n          if (el.childNodes[i].id != \"iframe-\" + widgetInstance.guid) {\n            el.removeChild(el.childNodes[i]);\n          }\n        }\n      });\n      widgetInstance.appendToDomElement(el, true);\n      this.submitIframe();\n    };\n    /**\r\n     * Open widget in redirect mode on new browser tab\r\n     */\n\n\n    this.showNewTab = function () {\n      window.location.href = this.buildFullUrl();\n    };\n    /**\r\n     * Show modal window for widget\r\n     */\n\n\n    this.showPopup = function () {\n      this.setFrameMode(FRAME_MODE_POPUP); //create iframe\n\n      this.createIframe(); //append iframe to popup\n\n      var modal_body_el = document.getElementById(MODAL_BODY_ID);\n      this.appendToDomElement(modal_body_el, true);\n      this.submitIframe(); //create close button\n\n      var closeBtn = document.getElementById(BTN_CLOSE_ID);\n      var widgetCloseBtn = closeBtn.cloneNode(true);\n      document.getElementById(MODAL_CONTAINER_ID).childNodes[0].replaceChild(widgetCloseBtn, closeBtn);\n      widgetCloseBtn.addEventListener(\"click\", widgetInstance.closePopup);\n      var modalWrapEl = document.getElementById(MODAL_CONTAINER_ID);\n      modalWrapEl.className = \"\";\n\n      if (this.config.css_modal_wrap) {\n        modalWrapEl.classList.add(this.config.css_modal_wrap);\n      }\n\n      if (WidgetLibrary.isMobile()) {\n        modalWrapEl.classList.add(\"modal-mobile\");\n      }\n\n      WidgetLibrary.showModal();\n\n      if (config.close_on_missclick) {\n        var backdrop_el = document.getElementById(MODAL_CONTAINER_ID);\n        backdrop_el.addEventListener(\"click\", widgetInstance.closePopup);\n      }\n    };\n\n    this.setFrameMode = function (mode) {\n      this.frameMode = mode;\n    };\n    /**\r\n     * Close modal window\r\n     */\n\n\n    this.closePopup = function () {\n      widgetInstance.sendPostMessage({\n        message: \"close\"\n      });\n      widgetInstance.onExit();\n\n      if (widgetInstance.config.onExit && typeof widgetInstance.config.onExit == \"function\") {\n        widgetInstance.config.onExit.apply(widgetInstance, []);\n      }\n\n      var backdrop_el = document.getElementById(MODAL_CONTAINER_ID);\n      backdrop_el.removeEventListener(\"click\", widgetInstance.closePopup);\n      widgetInstance.redirectComplete();\n      widgetInstance.unloadIframe(widgetInstance.iframe);\n    };\n    /**\r\n     * Append new element to DOM\r\n     * @param el\r\n     * @param clean\r\n     */\n\n\n    this.appendToDomElement = function (el, clean) {\n      var widget = this;\n\n      if (clean) {\n        el.innerHTML = \"\";\n      }\n\n      el.appendChild(widgetInstance.iframe);\n\n      widgetInstance.iframe.onload = function () {\n        widgetInstance.iframe.contentWindow.postMessage(JSON.stringify({\n          message: \"link\",\n          guid: widgetInstance.guid,\n          config: widgetInstance.config\n        }), widget.getBaseUrl());\n      };\n    };\n    /**\r\n     * Bind listeners\r\n     */\n\n\n    this.bindLisenetrs = function () {\n      this.btn.addEventListener(\"click\", function () {\n        widgetInstance.run();\n      });\n\n      window.onresize = function (event) {\n        widgetInstance.sendPostMessage({\n          message: \"resize\"\n        });\n      };\n    };\n    /**\r\n     * run widget\r\n     */\n\n\n    this.run = function () {\n      this.triggerCallbackByName(\"onRun\");\n\n      if (config.redirect) {\n        widgetInstance.showNewTab();\n      } else if (config.redirect_on_mobile && WidgetLibrary.isMobile()) {\n        widgetInstance.showNewTab();\n      } else if (config.hasOwnProperty(\"target_element\") && config.target_element) {\n        widgetInstance.showInSiteElement();\n      } else {\n        widgetInstance.showPopup();\n      }\n    };\n    /**\r\n     * Convert post message to callback function and trigger\r\n     *\r\n     * @param msg\r\n     */\n\n\n    this.triggerCallbackFromPostMessage = function (msg) {\n      function _isChangeCallback(fnName) {\n        return [\"onResize\", \"onAmountChange\", \"onTabChange\"].indexOf(fnName) + 1;\n      }\n\n      function _triggerIfChange(fn, data) {\n        if (_isChangeCallback(fn)) {\n          switch (fn) {\n            case \"onAmountChange\":\n              if (widgetInstance.callback_last_state.onAmountChange.value == data.value) {\n                return;\n              } else {\n                widgetInstance.callback_last_state.onAmountChange.value = data.value;\n              }\n\n              break;\n\n            case \"onTabChange\":\n              if (widgetInstance.callback_last_state.onTabChange.tab == data.tab) {\n                return;\n              } else {\n                widgetInstance.callback_last_state.onTabChange.tab = data.tab;\n              }\n\n              break;\n\n            case \"onResize\":\n              if (widgetInstance.callback_last_state.onResize.width == data.width && widgetInstance.callback_last_state.onResize.height == data.height) {\n                return;\n              } else {\n                widgetInstance.callback_last_state.onResize.width = data.width;\n                widgetInstance.callback_last_state.onResize.height = data.height;\n              }\n\n              break;\n          }\n        }\n\n        widgetInstance.triggerCallbackByName(fn, data);\n      }\n\n      var fn = (\"on.\" + msg.message.replace(\"epframe.\", \"\")).toCamelCase();\n\n      _triggerIfChange(fn, msg.data);\n    };\n    /**\r\n     * Trigger callback function by name\r\n     * @param callbackName\r\n     * @param data\r\n     */\n\n\n    this.triggerCallbackByName = function (callbackName, data) {\n      if (widgetInstance.config.hasOwnProperty(callbackName) && typeof widgetInstance.config[callbackName] == \"function\") {\n        widgetInstance.config[callbackName].apply(this, [data]);\n      }\n    };\n    /**\r\n     * Handle post message received from iframe\r\n     * @param eventData\r\n     */\n\n\n    this.handlePostMessage = function (eventData) {\n      console.log(\"%cPost message received\", \"color: green\", eventData);\n\n      switch (eventData.message) {\n        case MESSAGE_FAIL_LOADING:\n          eventData.data.config = widgetInstance.config;\n          this.widgetLoaded = true;\n          break;\n\n        case MESSAGE_RESIZE:\n          widgetInstance.modalResize(eventData.data.width, eventData.data.height);\n          break;\n\n        case MESSAGE_LOADED:\n          this.widgetLoaded = true;\n          widgetInstance.modalResize(eventData.data.width, eventData.data.height);\n          document.getElementById(\"ep-modal-wrap\").classList.add(\"loaded\");\n          break;\n\n        case MESSAGE_EXIT:\n          widgetInstance.onExit();\n          break;\n\n        case MESSAGE_REDIRECT:\n          window.location.href = eventData.data.url;\n          widgetInstance.onExit();\n          break;\n\n        case MESSAGE_REDIRECT_IFRAME:\n          widgetInstance.showIframeRedirect();\n          break;\n\n        case MESSAGE_REDIRECT_IFRAME_COMPLETE:\n          widgetInstance.redirectComplete();\n          break;\n\n        case MESSAGE_TEMPLATE_NAME:\n          widgetInstance.addMerchantCss(eventData.data);\n          break;\n\n        case MESSAGE_WITH_QR_PAY:\n          widgetInstance.addMerchantCss(eventData.data);\n          break;\n\n        case MESSAGE_CHANGE_CROSS_COLOR:\n          widgetInstance.changeCrossColor(eventData.data);\n          break;\n\n        case MESSAGE_RESIZE_FROM_ANOTHER_SRC:\n          var height = eventData.height ? eventData.height : window.innerHeight;\n          var width = eventData.width;\n          var msg = {\n            formAnotherSrc: true,\n            height: height,\n            width: width\n          };\n          widgetInstance.modalResize(width, height);\n          widgetInstance.iframe.contentWindow.postMessage(JSON.stringify(msg), \"*\");\n          break;\n\n        case MESSAGE_REMOVE_CSS_CLASS:\n          widgetInstance.removeCssClass(eventData.data);\n          break;\n      }\n\n      widgetInstance.triggerCallbackFromPostMessage(eventData);\n    };\n    /**\r\n     * Create iframe DOM element\r\n     * @returns {Element}\r\n     */\n\n\n    this.createIframe = function () {\n      var ifrm = document.createElement(\"iframe\");\n      ifrm.classList.add(\"ep-iframe\");\n      ifrm.style.display = \"block\";\n      ifrm.id = \"iframe-\" + widgetInstance.guid;\n      ifrm.name = ifrm.id;\n      ifrm.setAttribute(\"scrolling\", \"no\");\n      ifrm.setAttribute(\"allowPaymentRequest\", \"true\");\n      this.iframe = ifrm;\n      WidgetLibrary.registerPostListener(this);\n      return ifrm;\n    };\n    /**\r\n     * @private\r\n     */\n\n\n    this.submitIframe = function () {\n      this.checkIframeLoading();\n\n      if (this.method && this.method.toLocaleLowerCase() === \"post\") {\n        var form = this.buildForm();\n        document.body.appendChild(form);\n        form.submit();\n        document.body.removeChild(form);\n      } else {\n        this.iframe.setAttribute(\"src\", this.buildFullUrl());\n      }\n    };\n    /**\r\n     * @private\r\n     */\n\n\n    this.checkIframeLoading = function () {\n      this.iframe.addEventListener(\"load\", function () {\n        setTimeout(function () {\n          if (!this.widgetLoaded) {\n            this.handlePostMessage({\n              message: MESSAGE_FAIL_LOADING,\n              data: {\n                message: \"Network problem\"\n              }\n            });\n          }\n        }.bind(this), 5000);\n      }.bind(this));\n    };\n\n    this.sendPostMessage = function (msg) {\n      if (this.iframe.contentWindow) {\n        this.iframe.contentWindow.postMessage(JSON.stringify(msg), this.getBaseUrl());\n      }\n    };\n    /**\r\n     *\r\n     * @param btn\r\n     * @param config\r\n     * @private\r\n     */\n\n\n    this.init = function (btn, config) {\n      widgetInstance.config = _extendCfgFromDataAttributes(btn, config);\n      widgetInstance.validateConfig(config);\n      widgetInstance.bindLisenetrs();\n      widgetInstance.addMerchantCss();\n    };\n    /**\r\n     * Resize modal window by widget content size\r\n     * @param width\r\n     * @param height\r\n     */\n\n\n    this.modalResize = function (width, height) {\n      var iframe = this.iframe;\n\n      if (height == undefined) {\n        height = iframe.offsetHeight;\n      }\n\n      iframe.style.height = height + \"px\";\n      var modal = document.getElementById(MODAL_BODY_ID);\n      modal.style.height = height + \"px\";\n      iframe.style.display = \"block\";\n    };\n    /**\r\n     * @param {String} encryptedUrl\r\n     * @returns {PayWidget}\r\n     */\n\n\n    this.setEncryptedURL = function (encryptedUrl) {\n      this.encryptedUrl = encryptedUrl;\n      return this;\n    };\n    /**\r\n     * @returns {String}\r\n     */\n\n\n    this.buildUrl = function () {\n      var getParamsTail = \"\";\n      var config = this.config;\n      config.frame_mode = this.frameMode;\n\n      for (var k in config) {\n        if (config.hasOwnProperty(k)) {\n          if (typeof config[k] !== \"function\" && typeof config[\"k\"] !== \"object\") {\n            getParamsTail = WidgetLibrary.addGetParam(getParamsTail, k, config[k]);\n          }\n        }\n      }\n\n      var _sw = screen.width;\n      var _sh = screen.height;\n      getParamsTail = WidgetLibrary.addGetParam(getParamsTail, \"_sw\", _sw);\n      getParamsTail = WidgetLibrary.addGetParam(getParamsTail, \"_sh\", _sh);\n      return BASE_PATH + getParamsTail;\n    };\n    /**\r\n     * @returns {String}\r\n     * @private\r\n     */\n\n\n    this.buildFullUrl = function () {\n      var urlPathQuery = this.encryptedUrl ? this.encryptedUrl : this.buildUrl();\n      return this.getBaseUrl() + urlPathQuery;\n    };\n    /**\r\n     * @returns {HTMLFormElement}\r\n     * @private\r\n     */\n\n\n    this.buildForm = function () {\n      var cfg = this.config;\n      var form = document.createElement(\"form\");\n      cfg.frame_mode = this.frameMode;\n      form.setAttribute(\"method\", \"post\");\n      form.setAttribute(\"action\", this.getBaseUrl() + BASE_PATH);\n      form.setAttribute(\"target\", this.iframe.name);\n\n      for (var key in cfg) {\n        if (cfg.hasOwnProperty(key) && typeof cfg[key] !== \"function\" && typeof cfg[key] !== \"object\") {\n          var hiddenField = document.createElement(\"input\");\n          hiddenField.type = \"hidden\";\n          hiddenField.name = key;\n          hiddenField.value = config[key];\n          form.appendChild(hiddenField);\n        }\n      }\n\n      return form;\n    };\n    /**\r\n     *\r\n     * @param btn\r\n     * @param config\r\n     * @returns {*}\r\n     * @private\r\n     */\n\n\n    function _extendCfgFromDataAttributes(btn, config) {\n      if (\"referrer\" in document) {\n        config._referrer = document.referrer;\n      }\n\n      return config;\n    }\n    /**\r\n     * @param templateName\r\n     * @private\r\n     */\n\n\n    this.addMerchantCss = function (templateName) {\n      var cssPrefix = templateName ? templateName : null;\n      var modal_el = document.getElementById(MODAL_CONTAINER_ID);\n\n      if (templateName != null) {\n        modal_el.classList.add(cssPrefix);\n      } else {\n        modal_el.classList.remove(cssPrefix);\n      }\n    };\n    /**\r\n     * @param className\r\n     * @private\r\n     */\n\n\n    this.removeCssClass = function (className) {\n      var modal_el = document.getElementById(MODAL_CONTAINER_ID);\n\n      if (className != null && className != \"\") {\n        modal_el.classList.remove(className);\n      }\n    };\n\n    this.changeCrossColor = function (type) {\n      type = type.replace(/\"/g, \"\");\n      var el = document.getElementById(BTN_CLOSE_ID);\n      el.classList.add(type);\n    };\n    /**\r\n     * Unload iframe to log page unload events correctly\r\n     *\r\n     * @param iframe\r\n     * @private\r\n     */\n\n\n    this.unloadIframe = function (iframe) {\n      if (iframe && typeof iframe.setAttribute === \"function\") {\n        iframe.setAttribute(\"src\", \"\");\n      }\n    };\n\n    this.init(btn, config);\n  };\n  /**\r\n   * Library\r\n   * @type {{create: WidgetLibrary.create, appendHtml: WidgetLibrary.appendHtml}}\r\n   */\n\n\n  var WidgetLibrary = {\n    baseUrl: null,\n\n    /**\r\n     * Start point for widget init\r\n     * @param pay_btn_id\r\n     * @param {Object} config\r\n     * @param {string} method\r\n     * @returns {PayWidget}\r\n     */\n    bind: function (pay_btn_id, config, method) {\n      var payBtnEl = document.getElementById(pay_btn_id);\n\n      if (!payBtnEl) {\n        payBtnEl = document.createElement(\"button\");\n      }\n\n      var widgetConfig = config;\n      this.appendHtml();\n      return new PayWidget(WidgetLibrary.guid(4), payBtnEl, widgetConfig, method);\n    },\n\n    /**\r\n     * Create widget instance\r\n     * @param {Object} config\r\n     * @param {string} method\r\n     * @returns {PayWidget}\r\n     */\n    create: function (config, method) {\n      return this.bind(null, config, method);\n    },\n\n    /**\r\n     * Run widget immediate\r\n     * @param {Object} config\r\n     * @param {string} method\r\n     * @returns {*}\r\n     */\n    run: function (config, method) {\n      var inst = this.create(config, method);\n      inst.run();\n      return inst;\n    },\n\n    /**\r\n     * create DOM elements or get exist and bind it to widget\r\n     */\n    appendHtml: function () {\n      var modal_container_el = document.getElementById(MODAL_CONTAINER_ID);\n\n      if (!modal_container_el) {\n        modal_container_el = document.createElement(\"div\");\n        modal_container_el.setAttribute(\"id\", MODAL_CONTAINER_ID);\n        var modal_wrap_el = document.createElement(\"div\");\n        modal_wrap_el.setAttribute(\"class\", \"ep-modal-wrap\");\n        modal_wrap_el.setAttribute(\"id\", \"ep-modal-wrap\");\n        modal_container_el.appendChild(modal_wrap_el);\n        var modal_body_el = document.createElement(\"div\");\n        modal_body_el.setAttribute(\"id\", MODAL_BODY_ID);\n        modal_wrap_el.appendChild(modal_body_el);\n        var btn_close_el = document.createElement(\"button\");\n        btn_close_el.setAttribute(\"id\", BTN_CLOSE_ID);\n        modal_wrap_el.appendChild(btn_close_el);\n        document.body.appendChild(modal_container_el);\n      }\n    },\n\n    /**\r\n     * Show modal window\r\n     */\n    showModal: function () {\n      var modal = document.getElementById(MODAL_CONTAINER_ID);\n      modal.classList.add(\"shown\");\n    },\n\n    /**\r\n     * Extend config function\r\n     * @param out\r\n     * @returns {*|{}}\r\n     */\n    cfgExtend: function (out) {\n      out = out || {};\n\n      for (var i = 1; i < arguments.length; i++) {\n        var obj = arguments[i];\n        if (!obj) continue;\n\n        for (var key in obj) {\n          if (obj.hasOwnProperty(key)) {\n            if (typeof obj[key] === \"object\") out[key] = WidgetLibrary.cfgExtend(out[key], obj[key]);else out[key] = obj[key];\n          }\n        }\n      }\n\n      return out;\n    },\n\n    /**\r\n     * Generate GUID\r\n     * @param blocksCount\r\n     * @returns {string}\r\n     */\n    guid: function (blocksCount) {\n      function s4() {\n        return Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);\n      }\n\n      var result = \"\";\n\n      for (var i = 0; i < blocksCount; i++) {\n        if (i > 0) {\n          result += \"-\";\n        }\n\n        result += s4();\n      }\n\n      return result;\n    },\n\n    /**\r\n     * Register post message listener for all widget one time\r\n     * @param widgetInstance\r\n     */\n    registerPostListener: function (widgetInstance) {\n      if (window[\"widget\" + widgetInstance.guid + \"_post_listener\"] === true) {\n        return;\n      }\n\n      function _resolvePostMessageToWidgetInstance(e) {\n        try {\n          var data = JSON.parse(e.data);\n\n          if (data.guid && data.guid === widgetInstance.guid || data.from_another_domain) {\n            widgetInstance.handlePostMessage(data);\n          }\n        } catch (error) {}\n      }\n\n      if (window.addEventListener) {\n        window.addEventListener(\"message\", _resolvePostMessageToWidgetInstance);\n      } else {\n        window.attachEvent(\"onmessage\", _resolvePostMessageToWidgetInstance);\n      }\n\n      window[\"widget\" + widgetInstance.guid + \"_post_listener\"] = true;\n    },\n\n    /**\r\n     * Check client browser is mobile\r\n     * @returns {boolean}\r\n     */\n    isMobile: function () {\n      return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent.toString());\n    },\n\n    /**\r\n     * Get host of merchant.js file\r\n     * @returns {null}\r\n     */\n    getBaseUrl: function () {\n      if (this.baseUrl === null) {\n        var host = null;\n        var scripts = document.getElementsByTagName(\"script\");\n\n        for (var i = 0; i < scripts.length; i++) {\n          var src = scripts[i].src;\n\n          if (/.*?\\/merchant.js$/.test(src)) {\n            var match = /(http(s)?\\:\\/\\/[\\w+\\.-]+)/.exec(src);\n\n            if (match !== null) {\n              this.baseUrl = match[0];\n            } else {\n              throw \"Can't get base url of your merchant.js script. Use cfg.baseUrl\";\n            }\n\n            break;\n          }\n        }\n      }\n\n      return this.baseUrl;\n    },\n\n    /**\r\n     *\r\n     * @param url\r\n     * @param param\r\n     * @param value\r\n     * @returns {*}\r\n     */\n    addGetParam: function (url, param, value) {\n      if (value === undefined) {\n        return url;\n      }\n\n      return url + (/\\?/.test(url) ? \"&\" : \"?\") + param + \"=\" + encodeURIComponent(value);\n    }\n  };\n  /**\r\n   * Convert underscore_string to camelCase string\r\n   * @returns {string}\r\n   */\n\n  String.prototype.toCamelCase = function () {\n    return this.replace(/[_\\. ](.)/g, function ($1) {\n      return $1.toUpperCase();\n    }).replace(/\\s|\\.|_/g, \"\").replace(/^(.)/, function ($1) {\n      return $1.toLowerCase();\n    });\n  };\n\n  window.EPayWidget = WidgetLibrary;\n})();","map":{"version":3,"sources":["A:/WorkPorjects/Skill Box/greencosmicStudy/Frontend/src/Components/Ecommpay/merchant.js"],"names":["MODAL_CONTAINER_ID","MODAL_BODY_ID","BTN_CLOSE_ID","BASE_PATH","MESSAGE_FAIL_LOADING","MESSAGE_RESIZE","MESSAGE_LOADED","MESSAGE_EXIT","MESSAGE_REDIRECT","MESSAGE_REDIRECT_IFRAME","MESSAGE_REDIRECT_IFRAME_COMPLETE","MESSAGE_TEMPLATE_NAME","MESSAGE_WITH_QR_PAY","MESSAGE_CHANGE_CROSS_COLOR","MESSAGE_RESIZE_FROM_ANOTHER_SRC","MESSAGE_REMOVE_CSS_CLASS","MODE_PURCHASE","FRAME_MODE_IFRAME","FRAME_MODE_POPUP","FRAME_MODE_TAB","PayWidget","guid","btn","config","method","widgetInstance","iframe","widgetLoaded","frameMode","callback_last_state","onResize","width","height","onAmountChange","value","undefined","onTabChange","tab","getBaseUrl","baseUrl","WidgetLibrary","validateConfig","allowedModes","mode","indexOf","concat","payment_id","payment_currency","onExit","modal_el","document","getElementById","modal_body_el","classList","remove","removeAttribute","showIframeRedirect","add","redirectComplete","showInSiteElement","target_element","el","setFrameMode","childNodes","unloadIframe","createIframe","addEventListener","i","length","id","removeChild","appendToDomElement","submitIframe","showNewTab","window","location","href","buildFullUrl","showPopup","closeBtn","widgetCloseBtn","cloneNode","replaceChild","closePopup","modalWrapEl","className","css_modal_wrap","isMobile","showModal","close_on_missclick","backdrop_el","sendPostMessage","message","apply","removeEventListener","clean","widget","innerHTML","appendChild","onload","contentWindow","postMessage","JSON","stringify","bindLisenetrs","run","onresize","event","triggerCallbackByName","redirect","redirect_on_mobile","hasOwnProperty","triggerCallbackFromPostMessage","msg","_isChangeCallback","fnName","_triggerIfChange","fn","data","replace","toCamelCase","callbackName","handlePostMessage","eventData","console","log","modalResize","url","addMerchantCss","changeCrossColor","innerHeight","formAnotherSrc","removeCssClass","ifrm","createElement","style","display","name","setAttribute","registerPostListener","checkIframeLoading","toLocaleLowerCase","form","buildForm","body","submit","setTimeout","bind","init","_extendCfgFromDataAttributes","offsetHeight","modal","setEncryptedURL","encryptedUrl","buildUrl","getParamsTail","frame_mode","k","addGetParam","_sw","screen","_sh","urlPathQuery","cfg","key","hiddenField","type","_referrer","referrer","templateName","cssPrefix","pay_btn_id","payBtnEl","widgetConfig","appendHtml","create","inst","modal_container_el","modal_wrap_el","btn_close_el","cfgExtend","out","arguments","obj","blocksCount","s4","Math","floor","random","toString","substring","result","_resolvePostMessageToWidgetInstance","e","parse","from_another_domain","error","attachEvent","test","navigator","userAgent","host","scripts","getElementsByTagName","src","match","exec","param","encodeURIComponent","String","prototype","$1","toUpperCase","toLowerCase","EPayWidget"],"mappings":"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","sourcesContent":["(function () {\r\n  var MODAL_CONTAINER_ID = \"ep-modal-container\";\r\n  var MODAL_BODY_ID = \"ep-modal-body\";\r\n  var BTN_CLOSE_ID = \"ep-modal-close\";\r\n  var BASE_PATH = \"/payment\";\r\n\r\n  var MESSAGE_FAIL_LOADING = \"epframe.fail_loading\";\r\n  var MESSAGE_RESIZE = \"epframe.resize\";\r\n  var MESSAGE_LOADED = \"epframe.loaded\";\r\n  var MESSAGE_EXIT = \"epframe.exit\";\r\n  var MESSAGE_REDIRECT = \"epframe.redirect\";\r\n  var MESSAGE_REDIRECT_IFRAME = \"epframe.redirect_iframe\";\r\n  var MESSAGE_REDIRECT_IFRAME_COMPLETE = \"epframe.redirect_iframe_complete\";\r\n  var MESSAGE_TEMPLATE_NAME = \"epframe.template_name\";\r\n  var MESSAGE_WITH_QR_PAY = \"epframe.with_qr_pay\";\r\n  var MESSAGE_CHANGE_CROSS_COLOR = \"epframe.cross_color\";\r\n  var MESSAGE_RESIZE_FROM_ANOTHER_SRC = \"epframe.resize_from_another_src\";\r\n  var MESSAGE_REMOVE_CSS_CLASS = \"epframe.remove_css_class\";\r\n\r\n  var MODE_PURCHASE = \"purchase\";\r\n\r\n  var FRAME_MODE_IFRAME = \"iframe\";\r\n  var FRAME_MODE_POPUP = \"popup\";\r\n  var FRAME_MODE_TAB = \"tab\";\r\n\r\n  /**\r\n   * Class for widget instance\r\n   * @param {string} guid\r\n   * @param {HTMLElement} btn\r\n   * @param {Object} config\r\n   * @param {string} method\r\n   * @constructor\r\n   */\r\n  var PayWidget = function (guid, btn, config, method) {\r\n    var widgetInstance = this;\r\n    this.btn = btn;\r\n    this.iframe = null;\r\n    this.guid = guid;\r\n    this.method = method || \"get\";\r\n    this.widgetLoaded = false;\r\n    this.frameMode = FRAME_MODE_TAB;\r\n    this.callback_last_state = {\r\n      onResize: { width: 0, height: 0 },\r\n      onAmountChange: { value: undefined },\r\n      onTabChange: { tab: undefined },\r\n    };\r\n\r\n    this.getBaseUrl = function () {\r\n      if (config.baseUrl) {\r\n        return config.baseUrl;\r\n      } else {\r\n        return WidgetLibrary.getBaseUrl();\r\n      }\r\n    };\r\n\r\n    /**\r\n     * Validate config and fix it if possible\r\n     * @param config\r\n     */\r\n    this.validateConfig = function (config) {\r\n      var allowedModes = [\r\n        \"purchase\",\r\n        \"payout\",\r\n        \"card_tokenize\",\r\n        \"card_verify\",\r\n        \"money_transfer\",\r\n      ];\r\n\r\n      if (config.mode && allowedModes.indexOf(config.mode) < 0) {\r\n        throw \"Invalid config.mode. Use: \" + allowedModes.concat(\" | \");\r\n      }\r\n\r\n      if (\r\n        config.mode === MODE_PURCHASE &&\r\n        (!config.payment_id || !config.payment_currency)\r\n      ) {\r\n        throw \"Payment not specified.\";\r\n      }\r\n    };\r\n\r\n    /**\r\n     * Default onExit callback\r\n     */\r\n    this.onExit = function () {\r\n      var modal_el = document.getElementById(MODAL_CONTAINER_ID);\r\n      var modal_body_el = document.getElementById(MODAL_BODY_ID);\r\n      document.getElementById(\"ep-modal-wrap\").classList.remove(\"loaded\");\r\n      modal_body_el.removeAttribute(\"style\");\r\n      modal_el.classList.remove(\"shown\");\r\n    };\r\n\r\n    this.showIframeRedirect = function () {\r\n      document.getElementById(\"ep-modal-wrap\").classList.add(\"with-asc\");\r\n    };\r\n\r\n    this.redirectComplete = function () {\r\n      document.getElementById(\"ep-modal-wrap\").classList.remove(\"with-asc\");\r\n    };\r\n\r\n    /**\r\n     * Show widget in site DOM element\r\n     */\r\n    this.showInSiteElement = function () {\r\n      var target_element = config.target_element;\r\n      var el = null;\r\n\r\n      this.setFrameMode(FRAME_MODE_IFRAME);\r\n\r\n      if (typeof target_element == \"string\") {\r\n        el = document.getElementById(target_element);\r\n      } else {\r\n        el = config.target_element;\r\n      }\r\n\r\n      if (!el) {\r\n        throw \"Invalid target_element\";\r\n      }\r\n\r\n      if (el.childNodes[0]) {\r\n        this.unloadIframe(el.childNodes[0]);\r\n      }\r\n\r\n      var iframe = this.createIframe();\r\n\r\n      iframe.addEventListener(\"load\", function () {\r\n        for (var i = 0; i < el.childNodes.length; i++) {\r\n          if (el.childNodes[i].id != \"iframe-\" + widgetInstance.guid) {\r\n            el.removeChild(el.childNodes[i]);\r\n          }\r\n        }\r\n      });\r\n      widgetInstance.appendToDomElement(el, true);\r\n\r\n      this.submitIframe();\r\n    };\r\n\r\n    /**\r\n     * Open widget in redirect mode on new browser tab\r\n     */\r\n    this.showNewTab = function () {\r\n      window.location.href = this.buildFullUrl();\r\n    };\r\n\r\n    /**\r\n     * Show modal window for widget\r\n     */\r\n    this.showPopup = function () {\r\n      this.setFrameMode(FRAME_MODE_POPUP);\r\n      //create iframe\r\n      this.createIframe();\r\n\r\n      //append iframe to popup\r\n      var modal_body_el = document.getElementById(MODAL_BODY_ID);\r\n      this.appendToDomElement(modal_body_el, true);\r\n      this.submitIframe();\r\n\r\n      //create close button\r\n      var closeBtn = document.getElementById(BTN_CLOSE_ID);\r\n      var widgetCloseBtn = closeBtn.cloneNode(true);\r\n      document\r\n        .getElementById(MODAL_CONTAINER_ID)\r\n        .childNodes[0].replaceChild(widgetCloseBtn, closeBtn);\r\n      widgetCloseBtn.addEventListener(\"click\", widgetInstance.closePopup);\r\n\r\n      var modalWrapEl = document.getElementById(MODAL_CONTAINER_ID);\r\n\r\n      modalWrapEl.className = \"\";\r\n\r\n      if (this.config.css_modal_wrap) {\r\n        modalWrapEl.classList.add(this.config.css_modal_wrap);\r\n      }\r\n\r\n      if (WidgetLibrary.isMobile()) {\r\n        modalWrapEl.classList.add(\"modal-mobile\");\r\n      }\r\n\r\n      WidgetLibrary.showModal();\r\n\r\n      if (config.close_on_missclick) {\r\n        var backdrop_el = document.getElementById(MODAL_CONTAINER_ID);\r\n        backdrop_el.addEventListener(\"click\", widgetInstance.closePopup);\r\n      }\r\n    };\r\n\r\n    this.setFrameMode = function (mode) {\r\n      this.frameMode = mode;\r\n    };\r\n\r\n    /**\r\n     * Close modal window\r\n     */\r\n    this.closePopup = function () {\r\n      widgetInstance.sendPostMessage({ message: \"close\" });\r\n      widgetInstance.onExit();\r\n      if (\r\n        widgetInstance.config.onExit &&\r\n        typeof widgetInstance.config.onExit == \"function\"\r\n      ) {\r\n        widgetInstance.config.onExit.apply(widgetInstance, []);\r\n      }\r\n      var backdrop_el = document.getElementById(MODAL_CONTAINER_ID);\r\n      backdrop_el.removeEventListener(\"click\", widgetInstance.closePopup);\r\n      widgetInstance.redirectComplete();\r\n      widgetInstance.unloadIframe(widgetInstance.iframe);\r\n    };\r\n\r\n    /**\r\n     * Append new element to DOM\r\n     * @param el\r\n     * @param clean\r\n     */\r\n    this.appendToDomElement = function (el, clean) {\r\n      var widget = this;\r\n\r\n      if (clean) {\r\n        el.innerHTML = \"\";\r\n      }\r\n\r\n      el.appendChild(widgetInstance.iframe);\r\n\r\n      widgetInstance.iframe.onload = function () {\r\n        widgetInstance.iframe.contentWindow.postMessage(\r\n          JSON.stringify({\r\n            message: \"link\",\r\n            guid: widgetInstance.guid,\r\n            config: widgetInstance.config,\r\n          }),\r\n          widget.getBaseUrl()\r\n        );\r\n      };\r\n    };\r\n\r\n    /**\r\n     * Bind listeners\r\n     */\r\n    this.bindLisenetrs = function () {\r\n      this.btn.addEventListener(\"click\", function () {\r\n        widgetInstance.run();\r\n      });\r\n\r\n      window.onresize = function (event) {\r\n        widgetInstance.sendPostMessage({ message: \"resize\" });\r\n      };\r\n    };\r\n\r\n    /**\r\n     * run widget\r\n     */\r\n    this.run = function () {\r\n      this.triggerCallbackByName(\"onRun\");\r\n      if (config.redirect) {\r\n        widgetInstance.showNewTab();\r\n      } else if (config.redirect_on_mobile && WidgetLibrary.isMobile()) {\r\n        widgetInstance.showNewTab();\r\n      } else if (\r\n        config.hasOwnProperty(\"target_element\") &&\r\n        config.target_element\r\n      ) {\r\n        widgetInstance.showInSiteElement();\r\n      } else {\r\n        widgetInstance.showPopup();\r\n      }\r\n    };\r\n\r\n    /**\r\n     * Convert post message to callback function and trigger\r\n     *\r\n     * @param msg\r\n     */\r\n    this.triggerCallbackFromPostMessage = function (msg) {\r\n      function _isChangeCallback(fnName) {\r\n        return (\r\n          [\"onResize\", \"onAmountChange\", \"onTabChange\"].indexOf(fnName) + 1\r\n        );\r\n      }\r\n\r\n      function _triggerIfChange(fn, data) {\r\n        if (_isChangeCallback(fn)) {\r\n          switch (fn) {\r\n            case \"onAmountChange\":\r\n              if (\r\n                widgetInstance.callback_last_state.onAmountChange.value ==\r\n                data.value\r\n              ) {\r\n                return;\r\n              } else {\r\n                widgetInstance.callback_last_state.onAmountChange.value =\r\n                  data.value;\r\n              }\r\n              break;\r\n            case \"onTabChange\":\r\n              if (\r\n                widgetInstance.callback_last_state.onTabChange.tab == data.tab\r\n              ) {\r\n                return;\r\n              } else {\r\n                widgetInstance.callback_last_state.onTabChange.tab = data.tab;\r\n              }\r\n              break;\r\n            case \"onResize\":\r\n              if (\r\n                widgetInstance.callback_last_state.onResize.width ==\r\n                  data.width &&\r\n                widgetInstance.callback_last_state.onResize.height ==\r\n                  data.height\r\n              ) {\r\n                return;\r\n              } else {\r\n                widgetInstance.callback_last_state.onResize.width = data.width;\r\n                widgetInstance.callback_last_state.onResize.height =\r\n                  data.height;\r\n              }\r\n              break;\r\n          }\r\n        }\r\n        widgetInstance.triggerCallbackByName(fn, data);\r\n      }\r\n\r\n      var fn = (\"on.\" + msg.message.replace(\"epframe.\", \"\")).toCamelCase();\r\n\r\n      _triggerIfChange(fn, msg.data);\r\n    };\r\n\r\n    /**\r\n     * Trigger callback function by name\r\n     * @param callbackName\r\n     * @param data\r\n     */\r\n    this.triggerCallbackByName = function (callbackName, data) {\r\n      if (\r\n        widgetInstance.config.hasOwnProperty(callbackName) &&\r\n        typeof widgetInstance.config[callbackName] == \"function\"\r\n      ) {\r\n        widgetInstance.config[callbackName].apply(this, [data]);\r\n      }\r\n    };\r\n\r\n    /**\r\n     * Handle post message received from iframe\r\n     * @param eventData\r\n     */\r\n    this.handlePostMessage = function (eventData) {\r\n      console.log(\"%cPost message received\", \"color: green\", eventData);\r\n\r\n      switch (eventData.message) {\r\n        case MESSAGE_FAIL_LOADING:\r\n          eventData.data.config = widgetInstance.config;\r\n          this.widgetLoaded = true;\r\n          break;\r\n        case MESSAGE_RESIZE:\r\n          widgetInstance.modalResize(\r\n            eventData.data.width,\r\n            eventData.data.height\r\n          );\r\n          break;\r\n        case MESSAGE_LOADED:\r\n          this.widgetLoaded = true;\r\n          widgetInstance.modalResize(\r\n            eventData.data.width,\r\n            eventData.data.height\r\n          );\r\n          document.getElementById(\"ep-modal-wrap\").classList.add(\"loaded\");\r\n          break;\r\n        case MESSAGE_EXIT:\r\n          widgetInstance.onExit();\r\n          break;\r\n        case MESSAGE_REDIRECT:\r\n          window.location.href = eventData.data.url;\r\n          widgetInstance.onExit();\r\n          break;\r\n        case MESSAGE_REDIRECT_IFRAME:\r\n          widgetInstance.showIframeRedirect();\r\n          break;\r\n        case MESSAGE_REDIRECT_IFRAME_COMPLETE:\r\n          widgetInstance.redirectComplete();\r\n          break;\r\n        case MESSAGE_TEMPLATE_NAME:\r\n          widgetInstance.addMerchantCss(eventData.data);\r\n          break;\r\n        case MESSAGE_WITH_QR_PAY:\r\n          widgetInstance.addMerchantCss(eventData.data);\r\n          break;\r\n        case MESSAGE_CHANGE_CROSS_COLOR:\r\n          widgetInstance.changeCrossColor(eventData.data);\r\n          break;\r\n        case MESSAGE_RESIZE_FROM_ANOTHER_SRC:\r\n          var height = eventData.height ? eventData.height : window.innerHeight;\r\n          var width = eventData.width;\r\n          var msg = {\r\n            formAnotherSrc: true,\r\n            height: height,\r\n            width: width,\r\n          };\r\n          widgetInstance.modalResize(width, height);\r\n          widgetInstance.iframe.contentWindow.postMessage(\r\n            JSON.stringify(msg),\r\n            \"*\"\r\n          );\r\n          break;\r\n        case MESSAGE_REMOVE_CSS_CLASS:\r\n          widgetInstance.removeCssClass(eventData.data);\r\n          break;\r\n      }\r\n\r\n      widgetInstance.triggerCallbackFromPostMessage(eventData);\r\n    };\r\n\r\n    /**\r\n     * Create iframe DOM element\r\n     * @returns {Element}\r\n     */\r\n    this.createIframe = function () {\r\n      var ifrm = document.createElement(\"iframe\");\r\n      ifrm.classList.add(\"ep-iframe\");\r\n      ifrm.style.display = \"block\";\r\n      ifrm.id = \"iframe-\" + widgetInstance.guid;\r\n      ifrm.name = ifrm.id;\r\n      ifrm.setAttribute(\"scrolling\", \"no\");\r\n      ifrm.setAttribute(\"allowPaymentRequest\", \"true\");\r\n      this.iframe = ifrm;\r\n\r\n      WidgetLibrary.registerPostListener(this);\r\n\r\n      return ifrm;\r\n    };\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    this.submitIframe = function () {\r\n      this.checkIframeLoading();\r\n\r\n      if (this.method && this.method.toLocaleLowerCase() === \"post\") {\r\n        var form = this.buildForm();\r\n        document.body.appendChild(form);\r\n        form.submit();\r\n        document.body.removeChild(form);\r\n      } else {\r\n        this.iframe.setAttribute(\"src\", this.buildFullUrl());\r\n      }\r\n    };\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    this.checkIframeLoading = function () {\r\n      this.iframe.addEventListener(\r\n        \"load\",\r\n        function () {\r\n          setTimeout(\r\n            function () {\r\n              if (!this.widgetLoaded) {\r\n                this.handlePostMessage({\r\n                  message: MESSAGE_FAIL_LOADING,\r\n                  data: {\r\n                    message: \"Network problem\",\r\n                  },\r\n                });\r\n              }\r\n            }.bind(this),\r\n            5000\r\n          );\r\n        }.bind(this)\r\n      );\r\n    };\r\n\r\n    this.sendPostMessage = function (msg) {\r\n      if (this.iframe.contentWindow) {\r\n        this.iframe.contentWindow.postMessage(\r\n          JSON.stringify(msg),\r\n          this.getBaseUrl()\r\n        );\r\n      }\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param btn\r\n     * @param config\r\n     * @private\r\n     */\r\n    this.init = function (btn, config) {\r\n      widgetInstance.config = _extendCfgFromDataAttributes(btn, config);\r\n      widgetInstance.validateConfig(config);\r\n      widgetInstance.bindLisenetrs();\r\n      widgetInstance.addMerchantCss();\r\n    };\r\n\r\n    /**\r\n     * Resize modal window by widget content size\r\n     * @param width\r\n     * @param height\r\n     */\r\n    this.modalResize = function (width, height) {\r\n      var iframe = this.iframe;\r\n\r\n      if (height == undefined) {\r\n        height = iframe.offsetHeight;\r\n      }\r\n\r\n      iframe.style.height = height + \"px\";\r\n\r\n      var modal = document.getElementById(MODAL_BODY_ID);\r\n      modal.style.height = height + \"px\";\r\n      iframe.style.display = \"block\";\r\n    };\r\n\r\n    /**\r\n     * @param {String} encryptedUrl\r\n     * @returns {PayWidget}\r\n     */\r\n    this.setEncryptedURL = function (encryptedUrl) {\r\n      this.encryptedUrl = encryptedUrl;\r\n\r\n      return this;\r\n    };\r\n\r\n    /**\r\n     * @returns {String}\r\n     */\r\n    this.buildUrl = function () {\r\n      var getParamsTail = \"\";\r\n      var config = this.config;\r\n      config.frame_mode = this.frameMode;\r\n\r\n      for (var k in config) {\r\n        if (config.hasOwnProperty(k)) {\r\n          if (\r\n            typeof config[k] !== \"function\" &&\r\n            typeof config[\"k\"] !== \"object\"\r\n          ) {\r\n            getParamsTail = WidgetLibrary.addGetParam(\r\n              getParamsTail,\r\n              k,\r\n              config[k]\r\n            );\r\n          }\r\n        }\r\n      }\r\n\r\n      var _sw = screen.width;\r\n      var _sh = screen.height;\r\n\r\n      getParamsTail = WidgetLibrary.addGetParam(getParamsTail, \"_sw\", _sw);\r\n      getParamsTail = WidgetLibrary.addGetParam(getParamsTail, \"_sh\", _sh);\r\n\r\n      return BASE_PATH + getParamsTail;\r\n    };\r\n\r\n    /**\r\n     * @returns {String}\r\n     * @private\r\n     */\r\n    this.buildFullUrl = function () {\r\n      var urlPathQuery = this.encryptedUrl\r\n        ? this.encryptedUrl\r\n        : this.buildUrl();\r\n\r\n      return this.getBaseUrl() + urlPathQuery;\r\n    };\r\n\r\n    /**\r\n     * @returns {HTMLFormElement}\r\n     * @private\r\n     */\r\n    this.buildForm = function () {\r\n      var cfg = this.config;\r\n      var form = document.createElement(\"form\");\r\n      cfg.frame_mode = this.frameMode;\r\n      form.setAttribute(\"method\", \"post\");\r\n      form.setAttribute(\"action\", this.getBaseUrl() + BASE_PATH);\r\n      form.setAttribute(\"target\", this.iframe.name);\r\n\r\n      for (var key in cfg) {\r\n        if (\r\n          cfg.hasOwnProperty(key) &&\r\n          typeof cfg[key] !== \"function\" &&\r\n          typeof cfg[key] !== \"object\"\r\n        ) {\r\n          var hiddenField = document.createElement(\"input\");\r\n          hiddenField.type = \"hidden\";\r\n          hiddenField.name = key;\r\n          hiddenField.value = config[key];\r\n          form.appendChild(hiddenField);\r\n        }\r\n      }\r\n      return form;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param btn\r\n     * @param config\r\n     * @returns {*}\r\n     * @private\r\n     */\r\n    function _extendCfgFromDataAttributes(btn, config) {\r\n      if (\"referrer\" in document) {\r\n        config._referrer = document.referrer;\r\n      }\r\n      return config;\r\n    }\r\n\r\n    /**\r\n     * @param templateName\r\n     * @private\r\n     */\r\n    this.addMerchantCss = function (templateName) {\r\n      var cssPrefix = templateName ? templateName : null;\r\n      var modal_el = document.getElementById(MODAL_CONTAINER_ID);\r\n\r\n      if (templateName != null) {\r\n        modal_el.classList.add(cssPrefix);\r\n      } else {\r\n        modal_el.classList.remove(cssPrefix);\r\n      }\r\n    };\r\n\r\n    /**\r\n     * @param className\r\n     * @private\r\n     */\r\n    this.removeCssClass = function (className) {\r\n      var modal_el = document.getElementById(MODAL_CONTAINER_ID);\r\n\r\n      if (className != null && className != \"\") {\r\n        modal_el.classList.remove(className);\r\n      }\r\n    };\r\n\r\n    this.changeCrossColor = function (type) {\r\n      type = type.replace(/\"/g, \"\");\r\n      var el = document.getElementById(BTN_CLOSE_ID);\r\n      el.classList.add(type);\r\n    };\r\n\r\n    /**\r\n     * Unload iframe to log page unload events correctly\r\n     *\r\n     * @param iframe\r\n     * @private\r\n     */\r\n    this.unloadIframe = function (iframe) {\r\n      if (iframe && typeof iframe.setAttribute === \"function\") {\r\n        iframe.setAttribute(\"src\", \"\");\r\n      }\r\n    };\r\n\r\n    this.init(btn, config);\r\n  };\r\n\r\n  /**\r\n   * Library\r\n   * @type {{create: WidgetLibrary.create, appendHtml: WidgetLibrary.appendHtml}}\r\n   */\r\n  var WidgetLibrary = {\r\n    baseUrl: null,\r\n\r\n    /**\r\n     * Start point for widget init\r\n     * @param pay_btn_id\r\n     * @param {Object} config\r\n     * @param {string} method\r\n     * @returns {PayWidget}\r\n     */\r\n    bind: function (pay_btn_id, config, method) {\r\n      var payBtnEl = document.getElementById(pay_btn_id);\r\n      if (!payBtnEl) {\r\n        payBtnEl = document.createElement(\"button\");\r\n      }\r\n      var widgetConfig = config;\r\n      this.appendHtml();\r\n      return new PayWidget(\r\n        WidgetLibrary.guid(4),\r\n        payBtnEl,\r\n        widgetConfig,\r\n        method\r\n      );\r\n    },\r\n\r\n    /**\r\n     * Create widget instance\r\n     * @param {Object} config\r\n     * @param {string} method\r\n     * @returns {PayWidget}\r\n     */\r\n    create: function (config, method) {\r\n      return this.bind(null, config, method);\r\n    },\r\n\r\n    /**\r\n     * Run widget immediate\r\n     * @param {Object} config\r\n     * @param {string} method\r\n     * @returns {*}\r\n     */\r\n    run: function (config, method) {\r\n      var inst = this.create(config, method);\r\n      inst.run();\r\n      return inst;\r\n    },\r\n\r\n    /**\r\n     * create DOM elements or get exist and bind it to widget\r\n     */\r\n    appendHtml: function () {\r\n      var modal_container_el = document.getElementById(MODAL_CONTAINER_ID);\r\n      if (!modal_container_el) {\r\n        modal_container_el = document.createElement(\"div\");\r\n        modal_container_el.setAttribute(\"id\", MODAL_CONTAINER_ID);\r\n\r\n        var modal_wrap_el = document.createElement(\"div\");\r\n        modal_wrap_el.setAttribute(\"class\", \"ep-modal-wrap\");\r\n        modal_wrap_el.setAttribute(\"id\", \"ep-modal-wrap\");\r\n        modal_container_el.appendChild(modal_wrap_el);\r\n\r\n        var modal_body_el = document.createElement(\"div\");\r\n        modal_body_el.setAttribute(\"id\", MODAL_BODY_ID);\r\n        modal_wrap_el.appendChild(modal_body_el);\r\n\r\n        var btn_close_el = document.createElement(\"button\");\r\n        btn_close_el.setAttribute(\"id\", BTN_CLOSE_ID);\r\n        modal_wrap_el.appendChild(btn_close_el);\r\n\r\n        document.body.appendChild(modal_container_el);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Show modal window\r\n     */\r\n    showModal: function () {\r\n      var modal = document.getElementById(MODAL_CONTAINER_ID);\r\n      modal.classList.add(\"shown\");\r\n    },\r\n\r\n    /**\r\n     * Extend config function\r\n     * @param out\r\n     * @returns {*|{}}\r\n     */\r\n    cfgExtend: function (out) {\r\n      out = out || {};\r\n\r\n      for (var i = 1; i < arguments.length; i++) {\r\n        var obj = arguments[i];\r\n\r\n        if (!obj) continue;\r\n\r\n        for (var key in obj) {\r\n          if (obj.hasOwnProperty(key)) {\r\n            if (typeof obj[key] === \"object\")\r\n              out[key] = WidgetLibrary.cfgExtend(out[key], obj[key]);\r\n            else out[key] = obj[key];\r\n          }\r\n        }\r\n      }\r\n\r\n      return out;\r\n    },\r\n\r\n    /**\r\n     * Generate GUID\r\n     * @param blocksCount\r\n     * @returns {string}\r\n     */\r\n    guid: function (blocksCount) {\r\n      function s4() {\r\n        return Math.floor((1 + Math.random()) * 0x10000)\r\n          .toString(16)\r\n          .substring(1);\r\n      }\r\n\r\n      var result = \"\";\r\n      for (var i = 0; i < blocksCount; i++) {\r\n        if (i > 0) {\r\n          result += \"-\";\r\n        }\r\n        result += s4();\r\n      }\r\n      return result;\r\n    },\r\n\r\n    /**\r\n     * Register post message listener for all widget one time\r\n     * @param widgetInstance\r\n     */\r\n    registerPostListener: function (widgetInstance) {\r\n      if (window[\"widget\" + widgetInstance.guid + \"_post_listener\"] === true) {\r\n        return;\r\n      }\r\n\r\n      function _resolvePostMessageToWidgetInstance(e) {\r\n        try {\r\n          var data = JSON.parse(e.data);\r\n          if (\r\n            (data.guid && data.guid === widgetInstance.guid) ||\r\n            data.from_another_domain\r\n          ) {\r\n            widgetInstance.handlePostMessage(data);\r\n          }\r\n        } catch (error) {}\r\n      }\r\n\r\n      if (window.addEventListener) {\r\n        window.addEventListener(\"message\", _resolvePostMessageToWidgetInstance);\r\n      } else {\r\n        window.attachEvent(\"onmessage\", _resolvePostMessageToWidgetInstance);\r\n      }\r\n\r\n      window[\"widget\" + widgetInstance.guid + \"_post_listener\"] = true;\r\n    },\r\n\r\n    /**\r\n     * Check client browser is mobile\r\n     * @returns {boolean}\r\n     */\r\n    isMobile: function () {\r\n      return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(\r\n        navigator.userAgent.toString()\r\n      );\r\n    },\r\n\r\n    /**\r\n     * Get host of merchant.js file\r\n     * @returns {null}\r\n     */\r\n    getBaseUrl: function () {\r\n      if (this.baseUrl === null) {\r\n        var host = null;\r\n\r\n        var scripts = document.getElementsByTagName(\"script\");\r\n\r\n        for (var i = 0; i < scripts.length; i++) {\r\n          var src = scripts[i].src;\r\n          if (/.*?\\/merchant.js$/.test(src)) {\r\n            var match = /(http(s)?\\:\\/\\/[\\w+\\.-]+)/.exec(src);\r\n            if (match !== null) {\r\n              this.baseUrl = match[0];\r\n            } else {\r\n              throw \"Can't get base url of your merchant.js script. Use cfg.baseUrl\";\r\n            }\r\n            break;\r\n          }\r\n        }\r\n      }\r\n\r\n      return this.baseUrl;\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param url\r\n     * @param param\r\n     * @param value\r\n     * @returns {*}\r\n     */\r\n    addGetParam: function (url, param, value) {\r\n      if (value === undefined) {\r\n        return url;\r\n      }\r\n      return (\r\n        url +\r\n        (/\\?/.test(url) ? \"&\" : \"?\") +\r\n        param +\r\n        \"=\" +\r\n        encodeURIComponent(value)\r\n      );\r\n    },\r\n  };\r\n\r\n  /**\r\n   * Convert underscore_string to camelCase string\r\n   * @returns {string}\r\n   */\r\n  String.prototype.toCamelCase = function () {\r\n    return this.replace(/[_\\. ](.)/g, function ($1) {\r\n      return $1.toUpperCase();\r\n    })\r\n      .replace(/\\s|\\.|_/g, \"\")\r\n      .replace(/^(.)/, function ($1) {\r\n        return $1.toLowerCase();\r\n      });\r\n  };\r\n\r\n  window.EPayWidget = WidgetLibrary;\r\n})();\r\n"]},"metadata":{},"sourceType":"module"}